<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Horario - Salas USM</title>

    <style>
        /* --- ESTILOS GENERALES --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212; /* Fondo Negro Mate */
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- BARRA SUPERIOR --- */
        .topbar {
            background-color: #1f1f1f;
            border-bottom: 1px solid #333;
            padding: 0 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            position: sticky;
            top: 0;
            z-index: 100;
            width: 100%;
        }

        .logo {
            font-size: 22px;
            font-weight: 600;
            color: #e0e0e0;
            text-decoration: none;
            letter-spacing: 1px;
        }

        .btn-nav {
            padding: 6px 14px;
            font-size: 14px;
            background-color: #4a4a4a;
            color: #ffffff;
            text-decoration: none;
            border-radius: 6px;
            border: 1px solid #5a5a5a;
            transition: 0.3s;
        }

        .btn-nav:hover {
            background-color: #616161;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .container {
            display: flex;
            flex: 1; 
            position: relative;
        }

        /* --- PANEL IZQUIERDO (BUSCADOR) --- */
        .left-panel {
            width: 300px; 
            min-width: 300px;
            background-color: #2c2c2c; 
            border-right: 1px solid #444;
            padding: 20px;
            position: sticky;
            top: 60px; 
            height: calc(100vh - 60px);
            overflow-y: auto;
            box-shadow: 5px 0 15px rgba(0,0,0,0.3);
            z-index: 10;
        }

        h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #ccc;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }

        .search-area {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .search-area input {
            flex: 1;
            padding: 8px;
            background-color: #383838;
            border: 1px solid #555;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            outline: none;
        }

        .search-area input:focus {
            border-color: #3498db;
        }

        .clear-input-btn {
            padding: 0 12px;
            background: #c0392b;
            border: none;
            color: white;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }

        /* --- TARJETAS DE RESULTADOS --- */
        .result-item {
            background: #3a3a3a;
            padding: 15px; /* M√°s espacio interno */
            margin-bottom: 12px;
            border-radius: 8px;
            font-size: 13px;
            border-left: 4px solid #555;
            transition: 0.2s;
            display: flex;
            flex-direction: column; /* Organiza contenido verticalmente */
        }

        .result-item:hover {
            background: #444;
            border-left-color: #3498db;
        }

        /* --- BOT√ìN A√ëADIR CORREGIDO --- */
        .add-btn {
            margin-top: 12px;
            width: 100%;         /* Ocupa todo el ancho disponible */
            padding: 8px 0;      /* Relleno vertical normal, 0 horizontal */
            background: #3498db;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            font-weight: 600;
            font-size: 13px;
            text-align: center;
            transition: background 0.2s;
        }

        .add-btn:hover {
            background: #2980b9;
        }

        /* --- PANEL DERECHO (HORARIO) --- */
        .right-panel {
            flex: 1; 
            padding: 30px;
            background-color: #121212;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .schedule-controls {
            width: 100%;
            max-width: 1000px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        #btn-limpiar-horario {
            padding: 8px 16px;
            background: #c0392b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
        }

        /* --- TABLA --- */
        .table-container {
            width: 100%;
            max-width: 1000px;
            border-radius: 8px;
            overflow: hidden; 
            border: 1px solid #444;
            margin-bottom: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #1e1e1e;
        }

        th, td {
            border: 1px solid #333;
            padding: 5px;
            text-align: center;
            vertical-align: middle;
            color: #ddd;
            font-size: 14px;
        }

        th {
            background: #2c2c2c;
            color: #fff;
            padding: 10px;
            font-weight: 600;
        }

        td:first-child {
            background-color: #252525;
            font-weight: bold;
            color: #888;
            width: 70px;
        }

        .cell {
            height: 50px; 
            transition: background 0.2s;
        }

        .cell:hover {
            background-color: #252525;
        }

        .ramo {
            background: #2980b9;
            color: white;
            padding: 4px 6px;
            border-radius: 3px;
            display: block;
            margin: 1px;
            font-size: 11px;
            text-align: left;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Scrollbar oscura */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #121212;
        }
        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 5px;
        }
    </style>
</head>

<body>

<div class="topbar">
    <a href="index.html" class="logo">Salas USM</a>
    <a href="index.html" class="btn-nav">‚Üê Volver al men√∫</a>
</div>

<div class="container">

    <div class="left-panel">
        <h2>Buscar Asignatura</h2>

        <div class="search-area">
            <input type="text" id="buscar" placeholder="Sigla (ej: MAT021)...">
            <button class="clear-input-btn" id="limpiar" title="Borrar b√∫squeda">‚úï</button>
        </div>

        <div id="resultados">
            <p style="color: #666; font-style: italic; text-align: center; margin-top: 20px;">
                Escribe una sigla para buscar.
            </p>
        </div>
    </div>

    <div class="right-panel">

        <div class="schedule-controls">
            <h2>Tu Horario</h2>
            <button id="btn-limpiar-horario">üóë Limpiar</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Bloque</th>
                        <th>Lunes</th>
                        <th>Martes</th>
                        <th>Mi√©rcoles</th>
                        <th>Jueves</th>
                        <th>Viernes</th>
                    </tr>
                </thead>
                <tbody id="tabla">
                    </tbody>
            </table>
        </div>

    </div>

</div>

<script>
    // ============================================
    // GENERAR TABLA
    // ============================================
    const bloques = ["1-2","3-4","5-6","7-8","9-10","11-12","13-14","15-16"];
    const tbody = document.getElementById("tabla");

    bloques.forEach(b => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${b}</td>
            <td class="cell" data-dia="Lunes" data-bloque="${b}"></td>
            <td class="cell" data-dia="Martes" data-bloque="${b}"></td>
            <td class="cell" data-dia="Mi√©rcoles" data-bloque="${b}"></td>
            <td class="cell" data-dia="Jueves" data-bloque="${b}"></td>
            <td class="cell" data-dia="Viernes" data-bloque="${b}"></td>
        `;
        tbody.appendChild(tr);
    });

    // ============================================
    // LOGICA DE DATOS
    // ============================================
    let datos = [];
    let ramosUnicos = [];
    let ramosEnHorario = new Set();

    fetch("data/salas.json")
        .then(r => r.json())
        .then(json => {
            datos = json;
            const mapa = new Map();
            json.forEach(r => {
                const clave = r.SIGLA + "-" + r.PARALELO;
                if (!mapa.has(clave)) mapa.set(clave, r);
            });
            ramosUnicos = Array.from(mapa.values());
        })
        .catch(err => console.error("Error cargando JSON:", err));

    function horaABloque(hora) {
        if(!hora) return null;
        const inicio = hora.split("-")[0];
        const h = parseInt(inicio.split(":")[0], 10);

        if (h < 9) return "1-2";
        if (h < 11) return "3-4";
        if (h < 13) return "5-6";
        if (h < 15) return "7-8";
        if (h < 17) return "9-10";
        if (h < 19) return "11-12";
        if (h < 21) return "13-14";
        return "15-16";
    }

    // ============================================
    // BUSQUEDA
    // ============================================
    const input = document.getElementById("buscar");
    const limpiarBtn = document.getElementById("limpiar");
    const resultadosDiv = document.getElementById("resultados");

    limpiarBtn.onclick = () => {
        input.value = "";
        resultadosDiv.innerHTML = '<p style="color: #666; font-style: italic; text-align: center; margin-top: 20px;">Escribe una sigla para buscar.</p>';
    };

    input.addEventListener("input", () => {
        const q = input.value.toLowerCase().trim();
        resultadosDiv.innerHTML = "";

        if (q.length < 2) return;

        const filtrados = ramosUnicos.filter(r =>
            r.SIGLA.toLowerCase().includes(q)
        );

        if (filtrados.length === 0) {
            resultadosDiv.innerHTML = '<p style="color: #666; text-align: center;">No encontrado.</p>';
            return;
        }

        filtrados.forEach(r => {
            const div = document.createElement("div");
            div.className = "result-item";
            div.innerHTML = `
                <div style="margin-bottom:5px;">
                    <strong style="color:white; font-size:1.1em;">${r.SIGLA}</strong> 
                    <span style="color:#aaa;">- P ${r.PARALELO}</span>
                </div>
                <div style="color:#ccc; margin-bottom:8px;">${r.NOMBRE}</div>
                <div style="font-size:0.9em; color:#888;">${r.PROFESOR || "Sin profesor"}</div>
                <button class="add-btn" data-sigla="${r.SIGLA}" data-paralelo="${r.PARALELO}">
                    + A√±adir
                </button>
            `;
            resultadosDiv.appendChild(div);
        });
    });

    // ============================================
    // A√ëADIR
    // ============================================
    document.addEventListener("click", e => {
        if (!e.target.classList.contains("add-btn")) return;

        const sigla = e.target.dataset.sigla;
        const paralelo = e.target.dataset.paralelo;
        const clave = sigla + "-" + paralelo;

        if (ramosEnHorario.has(clave)) {
            alert("‚ö†Ô∏è Este ramo ya est√° en tu horario.");
            return;
        }

        ramosEnHorario.add(clave);

        const cursos = datos.filter(r => r.SIGLA === sigla && r.PARALELO === paralelo);

        cursos.forEach(r => {
            const bloque = horaABloque(r.HORA);
            if(!bloque) return;

            const celda = document.querySelector(
                `td[data-dia="${r.DIA}"][data-bloque="${bloque}"]`
            );

            if (celda) {
                const tag = document.createElement("div");
                tag.className = "ramo";
                tag.innerHTML = `<strong>${r.SIGLA}</strong><br><small>Sala ${r.SALA}</small>`;
                celda.appendChild(tag);
            }
        });
    });

    document.getElementById("btn-limpiar-horario").onclick = () => {
        if(confirm("¬øBorrar todo el horario?")) {
            document.querySelectorAll(".cell").forEach(c => c.innerHTML = "");
            ramosEnHorario.clear();
        }
    };
</script>

</body>
</html>